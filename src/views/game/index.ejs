<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>CyberStore - Trang Ch·ªß</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <header>
        <a href="/"><h1>üéÆ CyberStore</h1></a>

        <form action="/" method="GET" class="search-box">
            <input type="text" name="search" placeholder="T√¨m game..." value="<%= searchQuery %>">
            <button type="submit">üîç</button>
        </form>

        <div class="nav-group">
            <% if (!currentUser) { %>
                <a href="/login" class="btn btn-login">ƒêƒÉng nh·∫≠p</a>
            <% } else { %>
                <% if (currentUser.role === 'admin') { %>
                    <span style="color: #bb86fc; font-weight: bold;">üõ°Ô∏è BOSS</span>
                    <a href="/admin/orders" class="btn btn-admin">ƒê∆°n H√†ng</a>
                    <a href="/admin/add-game" class="btn btn-admin">+ Th√™m</a>
                <% } else { %>
                    <span style="color: white;">Hi, <%= currentUser.username %></span>
                <% } %>
                <form action="/logout" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-delete">Tho√°t</button>
                </form>
            <% } %>
            <% let totalQty = 0; if (cart) cart.forEach(i => totalQty += i.quantity); %>
            <a href="/cart" class="btn btn-cart">üõí (<%= totalQty %>)</a>
        </div>
    </header>

    <% if (currentPage == 1 && !searchQuery) { %>
    <div class="slider-container">
        <div class="slider-wrapper" id="slider">
            <div class="slide">
                <img src="https://image.api.playstation.com/vulcan/ap/rnd/202207/1210/4xJ8XB3bi888QTLZYdl7Oi0s.png" alt="GOW">
                <div class="slide-content">
                    <h2>God of War Ragnar√∂k</h2>
                    <p>H√†nh tr√¨nh c·ªßa Kratos v√† Atreus.</p>
                </div>
            </div>
            <div class="slide">
                <img src="https://image.api.playstation.com/vulcan/ap/rnd/202110/2000/phvVT0qZfcRms5qDAk0SI3CM.png" alt="Elden Ring">
                <div class="slide-content">
                    <h2>Elden Ring</h2>
                    <p>Tr·ªü th√†nh Elden Lord trong th·∫ø gi·ªõi m·ªü.</p>
                </div>
            </div>
            <div class="slide">
                <img src="https://vulcanpost.com/wp-content/uploads/2015/04/GTAV-Review.jpg" alt="GTA V">
                <div class="slide-content">
                    <h2>Grand Theft Auto V</h2>
                    <p>Th·∫ø gi·ªõi t·ªôi ph·∫°m ƒë·∫ßy k·ªãch t√≠nh.</p>
                </div>
            </div>
        </div>
    </div>
    <% } %>

    <div class="container">
        <div class="game-grid">
            <% games.forEach(game => { %>
                <div class="card">
                    <a href="/game/<%= game._id %>"><img src="<%= game.imageUrl %>"></a>
                    <div class="card-body">
                        <div class="card-title"><%= game.title %></div>
                        <div class="card-price">$<%= game.price %></div>
                        
                        <a href="/cart/add/<%= game._id %>" class="btn btn-buy">Mua Ngay</a>
                        <a href="/game/<%= game._id %>" class="btn btn-detail">Chi ti·∫øt</a>

                        <% if (currentUser && currentUser.role === 'admin') { %>
                            <div class="admin-controls">
                                <a href="/admin/edit/<%= game._id %>" class="btn btn-edit">S·ª≠a</a>
                                <form action="/admin/delete/<%= game._id %>" method="POST" onsubmit="return confirm('X√≥a?');">
                                    <button type="submit" class="btn btn-delete">X√≥a</button>
                                </form>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% }) %>
        </div>

        <% if (totalPages > 1) { %>
            <div class="pagination">
                <% for(let i = 1; i <= totalPages; i++) { %>
                    <a href="/?page=<%= i %>" class="<%= currentPage == i ? 'active' : '' %>"><%= i %></a>
                <% } %>
            </div>
        <% } %>
    </div>

    <script>
        const slider = document.getElementById('slider');
        if (slider) {
            let index = 0;
            setInterval(() => {
                index++;
                if (index > 2) index = 0; // C√≥ 3 slide (0, 1, 2)
                slider.style.transform = `translateX(-${index * 100}%)`;
            }, 3000); // Chuy·ªÉn ·∫£nh m·ªói 3 gi√¢y
        }
    </script>

</body>
</html>