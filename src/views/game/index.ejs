<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberStore - Trang Ch·ªß</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <header>
        <div class="header-inner">
            <div style="display: flex; align-items: center;">
                <a href="/"><h1>üéÆ CyberStore</h1></a>
                <div class="dropdown">
                    <button class="dropbtn">üìÇ Danh s√°ch th·ªÉ lo·∫°i ‚ñº</button>
                    <div class="dropdown-content">
                        <a href="/">üí† T·∫•t c·∫£ game</a>
                        <% if (typeof categories !== 'undefined') { %>
                            <% categories.forEach(cat => { %>
                                <a href="/?category=<%= cat %>">üéÆ <%= cat %></a>
                            <% }) %>
                        <% } %>
                    </div>
                </div>
            </div>

            <form action="/" method="GET" class="search-box">
                <input type="text" name="search" placeholder="T√¨m game..." value="<%= searchQuery %>">
                <button type="submit">üîç</button>
            </form>

            <div class="nav-group">
                <% if (!currentUser) { %>
                    <a href="/login" class="btn btn-login">ƒêƒÉng nh·∫≠p</a>
                <% } else { %>
                    <% if (currentUser.role === 'admin') { %>
                        <span style="color: #bb86fc; font-weight: bold;">üõ°Ô∏è BOSS</span>
                        <a href="/admin/users" class="btn btn-admin" title="User">üë•</a>
                        <a href="/admin/orders" class="btn btn-admin" title="ƒê∆°n">üì¶</a>
                        <a href="/admin/add-game" class="btn btn-admin" title="Th√™m">+</a>
                    <% } else { %>
                        <span style="color: white;">Hi, <%= currentUser.username %></span>
                    <% } %>
                    <form action="/logout" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-delete">Tho√°t</button>
                    </form>
                <% } %>
                <% let totalQty = 0; if (cart) cart.forEach(i => totalQty += i.quantity); %>
                <a href="/cart" class="btn btn-cart">üõí (<%= totalQty %>)</a>
            </div>
        </div>
    </header>

    <div class="container main-layout">
        
        <% if (currentPage == 1 && !searchQuery && !currentCategory) { %>
        <div class="slider-container" style="margin-top: 0; margin-bottom: 30px;">
            <div class="slider-wrapper" id="slider">
                <div class="slide"><img src="https://image.api.playstation.com/vulcan/ap/rnd/202207/1210/4xJ8XB3bi888QTLZYdl7Oi0s.png"><div class="slide-content"><h2>God of War Ragnar√∂k</h2></div></div>
                <div class="slide"><img src="https://image.api.playstation.com/vulcan/ap/rnd/202110/2000/phvVT0qZfcRms5qDAk0SI3CM.png"><div class="slide-content"><h2>Elden Ring</h2></div></div>
                <div class="slide"><img src="https://media-rockstargames-com.akamaized.net/tina-uploads/posts/k419k41k9r19/9560565730240d3653b8755850444800c23477e0.jpg"><div class="slide-content"><h2>GTA V</h2></div></div>
            </div>
        </div>
        <% } %>

        <% if (currentCategory) { %>
            <h2 style="color: var(--accent-color); border-bottom: 1px solid #333; padding-bottom: 10px;">üìÇ ƒêang xem: <%= currentCategory %></h2>
        <% } %>

        <div class="game-grid">
            <% if (games.length === 0) { %>
                <div style="text-align: center; width: 100%; padding: 50px; background: #1e1e1e;"><h3>üò¢ Kh√¥ng t√¨m th·∫•y game</h3></div>
            <% } else { %>
                <% games.forEach(game => { %>
                    <div class="card">
                        <a href="/game/<%= game._id %>"><img src="<%= game.imageUrl %>"></a>
                        <div class="card-body">
                            <div class="card-title"><%= game.title %></div>
                            
                            <div class="card-price">$<%= game.price %></div>
                            
                            <a href="/checkout/quick/<%= game._id %>" class="btn btn-buy">Mua Ngay</a>
                            <a href="/game/<%= game._id %>" class="btn btn-detail">Chi ti·∫øt</a>

                            <% if (currentUser && currentUser.role === 'admin') { %>
                                <div class="admin-controls">
                                    <a href="/admin/edit/<%= game._id %>" class="btn btn-edit">S·ª≠a</a>
                                    <form action="/admin/delete/<%= game._id %>" method="POST" onsubmit="return confirm('X√≥a?');" style="width: 48%;">
                                        <button type="submit" class="btn btn-delete" style="width: 100%;">X√≥a</button>
                                    </form>
                                </div>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
        
        <% if (totalPages > 1) { %>
            <div class="pagination">
                <% for(let i = 1; i <= totalPages; i++) { %>
                    <a href="/?page=<%= i %>&category=<%= currentCategory %>&search=<%= searchQuery %>" class="<%= currentPage == i ? 'active' : '' %>"><%= i %></a>
                <% } %>
            </div>
        <% } %>
    </div>

    <script>
        const slider = document.getElementById('slider');
        if (slider) { let idx = 0; setInterval(() => { idx++; if(idx>2) idx=0; slider.style.transform=`translateX(-${idx*100}%)`; }, 3000); }
    </script>
</body>
</html>