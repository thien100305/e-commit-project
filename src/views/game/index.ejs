<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberStore - Trang Ch·ªß</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <header>
        <div class="header-inner">
            <div style="display: flex; align-items: center;">
                <a href="/"><h1>üéÆ CyberStore</h1></a>

                <div class="dropdown">
                    <button class="dropbtn">üìÇ Danh s√°ch th·ªÉ lo·∫°i ‚ñº</button>
                    <div class="dropdown-content">
                        <a href="/">üí† T·∫•t c·∫£ game</a>
                        <% if (typeof categories !== 'undefined') { %>
                            <% categories.forEach(cat => { %>
                                <a href="/?category=<%= cat %>">üéÆ <%= cat %></a>
                            <% }) %>
                        <% } %>
                    </div>
                </div>
            </div>

            <form action="/" method="GET" class="search-box">
                <!-- Th√™m fallback || '' ƒë·ªÉ tr√°nh l·ªói undefined khi ch·∫°y test -->
                <input type="text" name="search" placeholder="T√¨m game..." value="<%= (typeof searchQuery !== 'undefined') ? searchQuery : '' %>">
                <button type="submit">üîç</button>
            </form>

            <div class="nav-group">
                <% if (!currentUser) { %>
                    <a href="/login" class="btn btn-login">ƒêƒÉng nh·∫≠p</a>
                <% } else { %>
                    <% if (currentUser.role === 'admin') { %>
                        <span style="color: #bb86fc; font-weight: bold;">üõ°Ô∏è BOSS</span>
                        <a href="/admin/users" class="btn btn-admin" title="Qu·∫£n l√Ω ng∆∞·ªùi d√πng">üë• Users</a>
                        <a href="/admin/orders" class="btn btn-admin" title="Qu·∫£n l√Ω ƒë∆°n h√†ng">üì¶ ƒê∆°n</a>
                        <a href="/admin/add-game" class="btn btn-admin" title="Th√™m game m·ªõi">+ Th√™m</a>
                    <% } else { %>
                        <span style="color: white;">Hi, <%= currentUser.username %></span>
                    <% } %>
                    
                    <form action="/logout" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-delete">Tho√°t</button>
                    </form>
                <% } %>

                <!-- Ki·ªÉm tra k·ªπ bi·∫øn cart ƒë·ªÉ tr√°nh crash -->
                <% let totalQty = 0; if (typeof cart !== 'undefined' && cart) cart.forEach(i => totalQty += i.quantity); %>
                <a href="/cart" class="btn btn-cart">üõí (<%= totalQty %>)</a>
            </div>
        </div>
    </header>

    <div class="container main-layout">
        
        <!-- Slider ch·ªâ hi·ªán ·ªü trang ch·ªß, kh√¥ng search, kh√¥ng l·ªçc category -->
        <% if (currentPage == 1 && (!typeof searchQuery !== 'undefined' || !searchQuery) && (!typeof currentCategory !== 'undefined' || !currentCategory)) { %>
        <div class="slider-container" style="margin-top: 0; margin-bottom: 30px;">
            <div class="slider-wrapper" id="slider">
                <div class="slide">
                    <img src="https://image.api.playstation.com/vulcan/ap/rnd/202207/1210/4xJ8XB3bi888QTLZYdl7Oi0s.png">
                    <div class="slide-content"><h2>God of War Ragnar√∂k</h2></div>
                </div>
                <div class="slide">
                    <img src="https://image.api.playstation.com/vulcan/ap/rnd/202110/2000/phvVT0qZfcRms5qDAk0SI3CM.png">
                    <div class="slide-content"><h2>Elden Ring</h2></div>
                </div>
                <div class="slide">
                    <img src="https://media-rockstargames-com.akamaized.net/tina-uploads/posts/k419k41k9r19/9560565730240d3653b8755850444800c23477e0.jpg">
                    <div class="slide-content"><h2>GTA V</h2></div>
                </div>
            </div>
        </div>
        <% } %>

        <% if (typeof currentCategory !== 'undefined' && currentCategory) { %>
            <h2 style="color: var(--accent-color); border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px;">
                üìÇ ƒêang xem th·ªÉ lo·∫°i: <%= currentCategory %>
            </h2>
        <% } %>

        <div class="game-grid">
            <% if (typeof games !== 'undefined' && games.length === 0) { %>
                <div style="text-align: center; width: 100%; padding: 50px; background: #1e1e1e; border-radius: 10px;">
                    <h3>üò¢ Kh√¥ng t√¨m th·∫•y game n√†o</h3>
                    <p>Th·ª≠ ch·ªçn danh m·ª•c kh√°c ho·∫∑c t√¨m ki·∫øm l·∫°i nh√©.</p>
                    <a href="/" class="btn btn-buy" style="width: auto;">Xem t·∫•t c·∫£</a>
                </div>
            <% } else if (typeof games !== 'undefined') { %>
                <% games.forEach(game => { %>
                    <div class="card">
                        <a href="/game/<%= game._id %>"><img src="<%= game.imageUrl %>"></a>
                        
                        <div class="card-body">
                            <div class="card-title"><%= game.title %></div>
                            
                            <small style="color: #888; display: block; margin-bottom: 5px;">üìÇ <%= game.category %></small>
                            
                            <div class="card-price">$<%= game.price %></div>
                            
                            <a href="/checkout/quick/<%= game._id %>" class="btn btn-buy">Mua Ngay</a>
                            <a href="/game/<%= game._id %>" class="btn btn-detail">Chi ti·∫øt</a>

                            <% if (typeof currentUser !== 'undefined' && currentUser && currentUser.role === 'admin') { %>
                                <div class="admin-controls">
                                    <a href="/admin/edit/<%= game._id %>" class="btn btn-edit">S·ª≠a</a>
                                    <form action="/admin/delete/<%= game._id %>" method="POST" onsubmit="return confirm('X√≥a game n√†y?');" style="width: 48%;">
                                        <button type="submit" class="btn btn-delete" style="width: 100%;">X√≥a</button>
                                    </form>
                                </div>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
        
        <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
            <div class="pagination">
                <% for(let i = 1; i <= totalPages; i++) { %>
                    <a href="/?page=<%= i %>&category=<%= (typeof currentCategory !== 'undefined' ? currentCategory : '') %>&search=<%= (typeof searchQuery !== 'undefined' ? searchQuery : '') %>" 
                       class="<%= currentPage == i ? 'active' : '' %>"><%= i %></a>
                <% } %>
            </div>
        <% } %>
        
        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>üéÆ CyberStore</h3>
                    <p>
                        N·ªÅn t·∫£ng ph√¢n ph·ªëi game b·∫£n quy·ªÅn h√†ng ƒë·∫ßu. 
                        Ch√∫ng t√¥i cam k·∫øt mang ƒë·∫øn nh·ªØng t·ª±a game ƒë·ªânh cao v·ªõi m·ª©c gi√° t·ªët nh·∫•t v√† d·ªãch v·ª• h·ªó tr·ª£ 24/7.
                    </p>
                </div>

                <div class="footer-section">
                    <h3>Li√™n K·∫øt</h3>
                    <ul>
                        <li><a href="/">‚Ä∫ Trang ch·ªß</a></li>
                        <li><a href="/cart">‚Ä∫ Gi·ªè h√†ng c·ªßa b·∫°n</a></li>
                        <li><a href="/login">‚Ä∫ ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</a></li>
                        <% if (typeof currentUser !== 'undefined' && currentUser && currentUser.role === 'admin') { %>
                            <li><a href="/admin/orders" style="color: var(--accent-color);">‚Ä∫ Qu·∫£n tr·ªã vi√™n</a></li>
                        <% } %>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Li√™n H·ªá</h3>
                    <p>üìç 123 ƒê∆∞·ªùng Gaming, Qu·∫≠n 1, TP.HCM</p>
                    <p>üìß hotro@cyberstore.com</p>
                    <p>üìû 1900 100 C√≥</p>
                    <p>‚è∞ M·ªü c·ª≠a: 8:00 - 22:00</p>
                </div>
            </div>

            <div class="copyright">
                &copy; 2024 CyberStore. All rights reserved. Designed by You.
            </div>
        </footer>
    </div>

    <script>
        const slider = document.getElementById('slider');
        if (slider) {
            let index = 0;
            setInterval(() => {
                index++;
                if (index > 2) index = 0; // Slider c√≥ 3 ·∫£nh (0, 1, 2)
                slider.style.transform = `translateX(-${index * 100}%)`;
            }, 3000); // Chuy·ªÉn ·∫£nh m·ªói 3 gi√¢y
        }
    </script>
</body>
</html>